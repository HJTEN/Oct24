<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tour Guide in Your Pocket</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* General styling for layout and design */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f4f4f9;
        }

        header {
            background: #4CAF50;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        main {
            padding: 1rem;
        }

        #camera-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #camera-feed {
            width: 100%;
            max-width: 600px;
            height: auto;
            border: 2px solid #ddd;
            border-radius: 8px;
        }

        #info-container {
            margin-top: 2rem;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        button {
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <header>
        <h1>Tour Guide in Your Pocket</h1>
    </header>
    <main>
        <!-- Camera feed -->
        <section id="camera-container">
            <h2>Live Camera Feed</h2>
            <video id="camera-feed" autoplay playsinline></video>
        </section>

        <!-- Landmark information -->
        <section id="info-container">
            <h2>Landmark Information</h2>
            <ul id="fact-list"></ul>
            <button id="read-aloud-btn">Read Facts Aloud</button>
            <button id="save-favorite-btn">Save to Favorites</button>
        </section>
    </main>

    <script>
        // Constants for API keys and URLs
        const GOOGLE_API_KEY = "AIzaSyA4Xo27wNyl5vJXm32137rlFa4VAcc7JJ4";
        const GEMINI_API_KEY = "AIzaSyAFizOjhryoAOW4KdGjCuqyrtPG3_sSclo";
        const VISION_API_URL = `https://vision.googleapis.com/v1/images:annotate?key=${GOOGLE_API_KEY}`;
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent`;

        // Elements from the DOM
        const video = document.getElementById("camera-feed");
        const factList = document.getElementById("fact-list");
        const readAloudBtn = document.getElementById("read-aloud-btn");
        const saveFavoriteBtn = document.getElementById("save-favorite-btn");

        // Camera feed setup
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                video.srcObject = stream;
            } catch (err) {
                console.error("Error starting camera:", err);
            }
        }

        // Google Vision API request
        async function detectLandmark() {
            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            const imageData = canvas.toDataURL("image/jpeg").split(",")[1];
            const visionRequest = {
                requests: [
                    {
                        image: { content: imageData },
                        features: [{ type: "LANDMARK_DETECTION", maxResults: 1 }],
                    },
                ],
            };

            try {
                const response = await fetch(VISION_API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(visionRequest),
                });
                const data = await response.json();
                const landmark = data.responses[0]?.landmarkAnnotations?.[0]?.description;

                if (landmark) {
                    console.log(`Detected landmark: ${landmark}`);
                    const facts = await fetchLandmarkFacts(landmark);
                    updateFactList(facts);
                } else {
                    console.log("No landmark detected.");
                }
            } catch (err) {
                console.error("Error detecting landmark:", err);
            }

            // Continuously process frames for detection
            requestAnimationFrame(detectLandmark);
        }

        // Gemini API integration for generating facts
        async function fetchLandmarkFacts(landmark) {
            const prompt = `Provide 5 interesting facts about ${landmark}.`;
            const geminiRequest = {
                prompt: { text: prompt },
                temperature: 0.7,
                maxOutputTokens: 200,
            };

            try {
                const response = await fetch(GEMINI_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${GEMINI_API_KEY}`,
                    },
                    body: JSON.stringify(geminiRequest),
                });
                const data = await response.json();
                return data.candidates[0]?.output.split("\n").filter(Boolean) || ["No facts found."];
            } catch (err) {
                console.error("Error fetching facts from Gemini:", err);
                return ["Error retrieving facts."];
            }
        }

        // Update the fact list in the UI
        function updateFactList(facts) {
            factList.innerHTML = ""; // Clear previous facts
            facts.forEach((fact) => {
                const listItem = document.createElement("li");
                listItem.textContent = fact;
                factList.appendChild(listItem);
            });
        }

        // Read facts aloud using Text-to-Speech
        readAloudBtn.addEventListener("click", () => {
            const speech = new SpeechSynthesisUtterance(
                Array.from(factList.children)
                    .map((li) => li.textContent)
                    .join(". ")
            );
            window.speechSynthesis.speak(speech);
        });

        // Save favorite landmark (placeholder)
        saveFavoriteBtn.addEventListener("click", () => {
            alert("Feature to save favorites coming soon!");
        });

        // Initialize camera and start detection
        startCamera().then(detectLandmark);
    </script>
</body>
</html>
